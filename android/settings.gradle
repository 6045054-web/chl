
include ':app'

// 在 GitHub Actions 环境中，android 目录的上一级就是项目根目录
def capacitorProjectDir = new File(settingsDir, "../node_modules/@capacitor/android/capacitor-android")

if (capacitorProjectDir.exists()) {
    include ':capacitor-android'
    project(':capacitor-android').projectDir = capacitorProjectDir
    println "--- [OK] 已找到 Capacitor 库: ${capacitorProjectDir.absolutePath} ---"
} else {
    // 调试辅助打印：如果找不到，看看当前在哪，周围有什么
    println "--- [ERROR] 找不到 Capacitor 库！ ---"
    println "预期路径: ${capacitorProjectDir.absolutePath}"
    println "当前 settingsDir: ${settingsDir.absolutePath}"
    
    // 备用路径尝试：有些情况下 node_modules 可能会在更深或更浅的层级
    def altPath = new File(settingsDir, "node_modules/@capacitor/android/capacitor-android")
    if (altPath.exists()) {
        include ':capacitor-android'
        project(':capacitor-android').projectDir = altPath
        println "--- [FIX] 在备用路径找到 Capacitor 库 ---"
    }
}

// 包含 Cordova 插件支持（如果存在）
def cordovaDir = new File(settingsDir, "../node_modules/@capacitor/android/capacitor-cordova-android-plugins")
if (cordovaDir.exists()) {
    include ':capacitor-cordova-android-plugins'
    project(':capacitor-cordova-android-plugins').projectDir = cordovaDir
}
